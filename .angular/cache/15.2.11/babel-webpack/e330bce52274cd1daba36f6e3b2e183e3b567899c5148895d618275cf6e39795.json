{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/luis1/Documents/htdocs/extras/angular-pwa-auto-seguros/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { environment } from 'src/environments/environment';\nimport Dexie from 'dexie';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"./online-offline.service\";\nexport let SeguroService = /*#__PURE__*/(() => {\n  class SeguroService {\n    constructor(http, onlineOfflineService) {\n      this.http = http;\n      this.onlineOfflineService = onlineOfflineService;\n      this.registrarEventos(onlineOfflineService);\n      this.criarDatabase();\n    }\n    criarDatabase() {\n      this.db = new Dexie('database');\n      this.db.version(1).stores({\n        seguros: 'placaCarro'\n      });\n    }\n    registrarEventos(onlineOfflineService) {\n      onlineOfflineService.trocaConexao.subscribe(online => {\n        if (online) {\n          console.log('enviando os itens do IndexedDb para a API');\n          this.enviarItensdoIndexedDb();\n        } else {\n          console.log('Offline. Salvando no IndexedDb');\n        }\n      });\n    }\n    salvar(seguro) {\n      if (this.onlineOfflineService.isOnline) {\n        this.salvarAPI(seguro);\n      } else {\n        this.salvarIndexedDb(seguro);\n      }\n    }\n    salvarAPI(seguro) {\n      console.log('mandando pra API');\n      this.http.post(environment.API + '/api/seguros', seguro).subscribe(() => {\n        alert('Seguro salvo com sucesso!');\n      }, err => console.error('Erro ao salvar seguro', err));\n    }\n    salvarIndexedDb(seguro) {\n      var _this = this;\n      this.db.seguros.add(seguro).then( /*#__PURE__*/_asyncToGenerator(function* () {\n        const todosSeguros = yield _this.db.seguros.toArray();\n        console.log('item salvo no IndexedDb', todosSeguros);\n      })).catch(err => console.log('erro ao incluir item no IndexedDb', err));\n    }\n    enviarItensdoIndexedDb() {\n      var _this2 = this;\n      return _asyncToGenerator(function* () {\n        const todosSeguros = yield _this2.db.seguros.toArray();\n        console.log(todosSeguros);\n        todosSeguros.forEach( /*#__PURE__*/function () {\n          var _ref2 = _asyncToGenerator(function* (item) {\n            yield _this2.salvarAPI(item);\n            _this2.db.seguros.delete(item.placaCarro).then(() => {\n              console.log(`seguro com a placa ${item.placaCarro} deletado do IndexedDb`);\n            });\n          });\n          return function (_x) {\n            return _ref2.apply(this, arguments);\n          };\n        }());\n      })();\n    }\n    listar() {\n      return this.http.get(environment.API + '/api/seguros');\n    }\n    static #_ = this.ɵfac = function SeguroService_Factory(t) {\n      return new (t || SeguroService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.OnlineOfflineService));\n    };\n    static #_2 = this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: SeguroService,\n      factory: SeguroService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n  return SeguroService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}